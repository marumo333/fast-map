# Fast-Map

Fast-Mapは、Google Maps Platformを活用した高速なルート検索アプリケーションです。Next.js、TypeScript、Tailwind CSSを使用して構築されています。

## 主な機能

- 🗺️ Google Maps Platformを使用した高精度な地図表示
- 🚗 リアルタイムの交通情報に基づく最適なルート検索
- 📍 現在地の自動取得と位置情報の利用
- 🔄 ルート変更の自動検出と通知
- 🎯 目的地までの所要時間の正確な予測
- 🔔 交通状況の変化に応じたリアルタイム通知
- 🔒 ユーザー認証機能（ログイン・ログアウト）
  - メールアドレスとパスワードによる認証
  - セッション管理（Cookieベース）
  - 未認証ユーザーの自動リダイレクト
  - ナビゲーションバーからのログアウト機能

## 認証機能

- ログイン必須のアプリケーション
- 未ログイン状態でのアクセスは自動的にログインページにリダイレクト
- ログイン状態はクッキーで管理
- ログアウト機能の実装
- セッション管理による自動ログアウト

## 使用制限

- 1人あたり1日3回までの目的地検索制限
  - Google Maps APIの使用量制限とコスト最適化のため
  - 日付が変わると自動的にリセット
  - 残り検索回数は毎回の検索時に表示

## 実装の苦労点

1. **認証システムの実装**
   - ミドルウェアによる認証チェック
   - クライアントサイドでのログイン状態管理
   - セキュアなクッキー管理
   - ログイン状態の永続化

2. **Google Maps APIの型定義とルート検索**
   - `@googlemaps/google-maps-services-js`の型定義が不完全で、特に`DirectionsStep`の型定義に苦労
   - 有料/無料道路の判定から最短/混雑回避ルートの判定に変更し、より実用的な機能に改善
   - ルート検索の最適化とパフォーマンス改善に注力

3. **ルート検索の最適化**
   - 複数のルート選択肢を表示する際のパフォーマンス最適化
   - 交通情報の取得と表示の実装
   - 不要なAPI呼び出しを防止するための制御機構の実装
   - エラー発生時の即時停止機能の実装

4. **エラーハンドリング**
   - APIのレスポンスに応じた適切なエラーメッセージの表示
   - ユーザーフレンドリーなエラー表示の実装
   - CORSエラーの解決と適切なヘッダー設定
   - エラー発生時の即時停止とリカバリー機能

5. **ダークモードの実装**
   - システムの設定に応じた自動切り替え
   - ユーザー設定の永続化（localStorage）
   - ページ遷移時の状態維持
   - コンポーネント間での状態共有（Context API）
   - スムーズな切り替えアニメーション

6. **位置情報の取得と表示**
   - ブラウザの位置情報APIの非同期処理
   - 位置情報の取得失敗時のフォールバック
   - 住所の逆ジオコーディング（緯度経度から住所への変換）

7. **リアルタイム通知**
   - 交通情報の定期的なポーリング
   - 通知の表示タイミングの最適化
   - 代替ルートの提案ロジック
   - エラー発生時の即時停止と再開機能

## 技術スタック

- **フロントエンド**: Next.js 14, TypeScript, Tailwind CSS
- **状態管理**: Redux Toolkit
- **地図API**: Google Maps Platform
- **認証**: カスタム認証システム
- **デプロイ**: Vercel

## デプロイ

このアプリケーションはVercelにデプロイされています。mainブランチへのプッシュが自動的にデプロイをトリガーします。

## 環境変数

以下の環境変数を設定する必要があります：

```env
NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=your_api_key
```

## 開発環境のセットアップ

1. リポジトリのクローン
```bash
git clone https://github.com/marumo333/fast-map.git
cd fast-map
```

2. 依存関係のインストール
```bash
npm install
```

3. 環境変数の設定
`.env.local`ファイルを作成し、必要な環境変数を設定：
```
NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=your_api_key
```

4. 開発サーバーの起動
```bash
npm run dev
```

## 今後の改善点

- 有料道路の判定機能の再実装
- より詳細な交通情報の表示
- ルートの保存機能
- ユーザー認証の追加

## ライセンス

MIT

---

詳細な要件・仕様は [PRD.md](./PRD.md) を参照してください。
